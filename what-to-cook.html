<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Everyone Chief · What to Cook</title>
  <style>
    :root { --bg:#fafafa; --card:#fff; --text:#222; --muted:#666; --brand:#5b7cfa; --line:#eee; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:10px 16px;display:flex;gap:12px;align-items:center;z-index:9}
    header a{color:var(--brand);text-decoration:none;font-weight:600}
    .wrap{display:grid;grid-template-columns:2fr 1fr;gap:16px;padding:16px}
    @media (max-width:1000px){.wrap{grid-template-columns:1fr}}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:150px;object-fit:cover;background:#ddd}
    .card h3{margin:10px 12px 0;font-size:16px}
    .card .meta{margin:6px 12px 10px;color:var(--muted);font-size:12px}
    .card .actions{margin:8px 12px 12px;display:flex;gap:8px}
    button, .btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .btn-primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;position:sticky;top:70px;height:fit-content}
    .panel h2{margin:6px 0 10px;font-size:18px}
    .row{display:flex;gap:8px;margin:6px 0}
    input[type=text], textarea{width:100%;padding:8px;border:1px solid var(--line);border-radius:8px}
    .chips{display:flex;flex-wrap:wrap;gap:6px;margin:6px 0}
    .chip{background:#f1f3ff;color:#2b3dbb;border:1px solid #dfe3ff;padding:3px 8px;border-radius:999px;font-size:12px}
    .hint{color:var(--muted);font-size:12px}
    .empty{color:var(--muted);padding:24px;text-align:center;border:1px dashed var(--line);border-radius:12px;background:#fff}
    /* modal */
    dialog{border:none;border-radius:16px;max-width:720px;width:96%;padding:0;overflow:hidden}
    .modal-head{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);padding:10px 14px;background:#fff}
    .modal-body{padding:14px;display:grid;grid-template-columns:220px 1fr;gap:14px}
    .modal-body img{width:100%;height:200px;object-fit:cover;border-radius:8px;background:#ddd}
    @media (max-width:700px){.modal-body{grid-template-columns:1fr}}
    ul{margin:6px 0 10px 18px}
    .toolbar{display:flex;gap:8px;align-items:center;margin:8px 0}
    .pill{background:#eef1f7;border:1px solid #dee3ef;padding:2px 8px;border-radius:999px;font-size:12px}
  </style>
</head>
<body>
<header>
  <strong>Everyone Chief · What to Cook</strong>
  <span class="pill" id="today-pill"></span>
  <div style="margin-left:auto;display:flex;gap:14px">
    <a href="index.html">Home</a>
    <a href="who-cooks.html">Cook Dashboard</a>
  </div>
</header>

<div class="wrap">
  <!-- 左侧：菜卡网格 -->
  <section>
    <div class="toolbar">
      <input id="search" type="text" placeholder="Search dishes…" />
      <button id="clearFilters">Clear</button>
      <span class="hint" id="countHint"></span>
    </div>
    <div id="dishGrid" class="grid"></div>
    <div id="emptyState" class="empty" style="display:none">No dishes yet. Add your first recipe on the right →</div>
  </section>

  <!-- 右侧：添加/编辑表单 -->
  <aside class="panel">
    <h2>Add a Recipe</h2>
    <div class="row"><input id="name" type="text" placeholder="Dish name (English)"/></div>
    <div class="row">
      <input id="image" type="file" accept="image/*"/>
    </div>

    <div class="row"><input id="ingredientInput" type="text" placeholder="Add ingredient…"/>
      <button id="addIng">Add</button></div>
    <div class="chips" id="ingredientList"></div>

    <div class="row"><input id="toolInput" type="text" placeholder="Add tool…"/>
      <button id="addTool">Add</button></div>
    <div class="chips" id="toolList"></div>

    <div class="row"><input id="stepInput" type="text" placeholder="Add step…"/>
      <button id="addStep">Add</button></div>
    <ol id="stepList" style="margin:6px 0 12px 22px;"></ol>

    <div class="row">
      <button class="btn-primary" id="save">Save Recipe</button>
      <button id="reset">Reset</button>
    </div>
    <p class="hint">Images are stored locally (browser) as data URLs. You can replace later.</p>
  </aside>
</div>

<!-- 详情 Modal -->
<dialog id="detail">
  <div class="modal-head">
    <strong id="mTitle">Dish</strong>
    <div style="display:flex;gap:8px">
      <button id="mAdd">Add to Today</button>
      <button id="mClose">Close</button>
    </div>
  </div>
  <div class="modal-body">
    <img id="mImg" alt="">
    <div>
      <h3>Ingredients</h3>
      <ul id="mIng"></ul>
      <h3>Tools</h3>
      <ul id="mTools"></ul>
      <h3>Steps</h3>
      <ol id="mSteps"></ol>
    </div>
  </div>
</dialog>

<script>
/** ---------- tiny data layer (localStorage) ---------- **/
const LS_KEYS = {
  DISHES: 'ec_dishes',
  TODAY_PREFIX: 'ec_today_' // + YYYY-MM-DD
};
const todayKey = () => LS_KEYS.TODAY_PREFIX + new Date().toISOString().slice(0,10);

function loadDishes(){
  const raw = localStorage.getItem(LS_KEYS.DISHES);
  if(raw){ return JSON.parse(raw); }
  // seed defaults (only once)
  const seed = [
    {id: crypto.randomUUID(), name:'Kung Pao Chicken', image:'https://images.unsplash.com/photo-1604908554027-6c9f3a7f4f8b?q=80&w=800&auto=format&fit=crop', 
      ingredients:['chicken','peanuts','dried chili','soy sauce','vinegar','sugar','garlic','ginger'],
      tools:['wok','knife','spatula'],
      steps:['Dice chicken','Stir-fry chili & aromatics','Add sauce','Toss with peanuts and finish']},
    {id: crypto.randomUUID(), name:'Fried Rice', image:'https://images.unsplash.com/photo-1598866594230-a7c12756260d?q=80&w=800&auto=format&fit=crop',
      ingredients:['day-old rice','egg','scallion','peas','soy sauce','oil'],
      tools:['wok','spatula'],
      steps:['Scramble eggs','Add rice','Season and toss','Finish with scallions']},
    {id: crypto.randomUUID(), name:'Tomato Egg Stir-fry', image:'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=800&auto=format&fit=crop',
      ingredients:['tomatoes','eggs','salt','sugar','scallion'],
      tools:['pan','spatula','bowl'],
      steps:['Beat eggs & fry softly','Stir-fry tomatoes','Combine & season']}
  ];
  localStorage.setItem(LS_KEYS.DISHES, JSON.stringify(seed));
  return seed;
}
function saveDishes(list){ localStorage.setItem(LS_KEYS.DISHES, JSON.stringify(list)); }

function loadToday(){
  const raw = localStorage.getItem(todayKey());
  return raw ? JSON.parse(raw) : []; // array of {id, qty, done:false}
}
function saveToday(arr){ localStorage.setItem(todayKey(), JSON.stringify(arr)); }

function addToToday(dishId){
  const arr = loadToday();
  const hit = arr.find(x=>x.id===dishId);
  if(hit){ hit.qty += 1; } else { arr.push({id:dishId, qty:1, done:false}); }
  saveToday(arr);
  updateTodayPill();
}

/** ---------- UI helpers ---------- **/
const grid = document.getElementById('dishGrid');
const empty = document.getElementById('emptyState');
const search = document.getElementById('search');
const countHint = document.getElementById('countHint');
const pill = document.getElementById('today-pill');

function updateTodayPill(){
  const arr = loadToday();
  const total = arr.reduce((s,x)=>s+x.qty,0);
  pill.textContent = `Today: ${total} item${total!==1?'s':''}`;
}

function renderGrid(filter=''){
  const dishes = loadDishes();
  const view = dishes.filter(d=>d.name.toLowerCase().includes(filter.toLowerCase()));
  grid.innerHTML = '';
  view.forEach(d=>{
    const card = document.createElement('div'); card.className='card';
    const img = document.createElement('img'); img.src = d.image || ''; img.alt = d.name;
    const h3 = document.createElement('h3'); h3.textContent = d.name;
    const meta = document.createElement('div'); meta.className='meta'; meta.textContent = `${d.ingredients.length} ingredients · ${d.steps.length} steps`;
    const actions = document.createElement('div'); actions.className='actions';
    const btnView = document.createElement('button'); btnView.textContent='View';
    const btnAdd = document.createElement('button'); btnAdd.textContent='Add to Today'; btnAdd.className='btn-primary';
    btnView.onclick = ()=>openModal(d.id);
    btnAdd.onclick = ()=>{ addToToday(d.id); btnAdd.textContent='Added ✓'; setTimeout(()=>btnAdd.textContent='Add to Today',900); };
    actions.append(btnView, btnAdd);
    card.append(img,h3,meta,actions);
    grid.append(card);
  });
  empty.style.display = view.length? 'none':'block';
  countHint.textContent = `${view.length}/${loadDishes().length} shown`;
}

updateTodayPill();
renderGrid();

/** ---------- search / clear ---------- **/
document.getElementById('clearFilters').onclick = ()=>{ search.value=''; renderGrid(''); }
search.addEventListener('input', e=> renderGrid(e.target.value));

/** ---------- modal ---------- **/
const modal = document.getElementById('detail');
const mTitle = document.getElementById('mTitle');
const mImg = document.getElementById('mImg');
const mIng = document.getElementById('mIng');
const mTools = document.getElementById('mTools');
const mSteps = document.getElementById('mSteps');
const mAdd = document.getElementById('mAdd');
document.getElementById('mClose').onclick = ()=>modal.close();

function openModal(id){
  const d = loadDishes().find(x=>x.id===id);
  if(!d) return;
  mTitle.textContent = d.name;
  mImg.src = d.image || '';
  mIng.innerHTML = d.ingredients.map(i=>`<li>${escapeHtml(i)}</li>`).join('');
  mTools.innerHTML = d.tools.map(i=>`<li>${escapeHtml(i)}</li>`).join('');
  mSteps.innerHTML = d.steps.map(i=>`<li>${escapeHtml(i)}</li>`).join('');
  mAdd.onclick = ()=>{ addToToday(d.id); mAdd.textContent='Added ✓'; setTimeout(()=>mAdd.textContent='Add to Today',900); };
  modal.showModal();
}
function escapeHtml(s){ return (s??'').toString().replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

/** ---------- Add Recipe form ---------- **/
const nameEl = document.getElementById('name');
const imgEl = document.getElementById('image');
const ingInput = document.getElementById('ingredientInput');
const toolInput = document.getElementById('toolInput');
const stepInput = document.getElementById('stepInput');
const ingList = document.getElementById('ingredientList');
const toolList = document.getElementById('toolList');
const stepList = document.getElementById('stepList');

let newIng=[], newTools=[], newSteps=[], newImgData=null;

function redrawChips(){
  ingList.innerHTML = newIng.map((t,i)=>`<span class="chip" data-i="${i}" data-type="ing">${escapeHtml(t)} ✕</span>`).join('');
  toolList.innerHTML = newTools.map((t,i)=>`<span class="chip" data-i="${i}" data-type="tool">${escapeHtml(t)} ✕</span>`).join('');
  stepList.innerHTML = newSteps.map((s,i)=>`<li>${escapeHtml(s)} <button data-i="${i}" data-type="step">Remove</button></li>`).join('');
}
document.getElementById('addIng').onclick = ()=>{ const v=ingInput.value.trim(); if(v){ newIng.push(v); ingInput.value=''; redrawChips(); }};
document.getElementById('addTool').onclick = ()=>{ const v=toolInput.value.trim(); if(v){ newTools.push(v); toolInput.value=''; redrawChips(); }};
document.getElementById('addStep').onclick = ()=>{ const v=stepInput.value.trim(); if(v){ newSteps.push(v); stepInput.value=''; redrawChips(); }};

ingList.onclick = e=>{ const el=e.target.closest('.chip'); if(!el) return; const i=+el.dataset.i; newIng.splice(i,1); redrawChips(); };
toolList.onclick = e=>{ const el=e.target.closest('.chip'); if(!el) return; const i=+el.dataset.i; newTools.splice(i,1); redrawChips(); };
stepList.onclick = e=>{ if(e.target.tagName==='BUTTON'){ const i=+e.target.dataset.i; newSteps.splice(i,1); redrawChips(); }};

imgEl.onchange = async (e)=>{
  const f = e.target.files?.[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ev => { newImgData = ev.target.result; };
  reader.readAsDataURL(f);
};

document.getElementById('reset').onclick = ()=>{
  nameEl.value=''; newIng=[]; newTools=[]; newSteps=[]; newImgData=null; ingInput.value=toolInput.value=stepInput.value=''; redrawChips();
};

document.getElementById('save').onclick = ()=>{
  const name = nameEl.value.trim();
  if(!name){ alert('Please enter a dish name.'); return; }
  const d = { id: crypto.randomUUID(), name, image: newImgData, ingredients:newIng, tools:newTools, steps:newSteps };
  const dishes = loadDishes(); dishes.push(d); saveDishes(dishes);
  document.getElementById('reset').click();
  renderGrid(search.value.trim());
  alert('Recipe saved!');
};
</script>
</body>
</html>

